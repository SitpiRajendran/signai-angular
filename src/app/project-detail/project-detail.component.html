<!-- https://balramchavan.medium.com/using-openstreetmap-inside-angular-v6-3d42cbf03e57 -->
<div class="columns m-0 p-0" style="background: #161616; width: 100%; height: 100%">
  <app-menu class="column is-2" style="display: flex; flex-direction: column; justify-content: space-between;"
    [contact_name]="'Sitpi RAJENDRAN'" [contact_mail]="'sitpi.rajendran@signai.fr'"
    [contact_telephone]="'+33.6.68.62.99.53'"></app-menu>
  <div class="column is-10">
    <div class="side-box">
      <div class="columns m-0 p-0" style="width: 100%; height: 100%;">
        <div class="column is-6" style="overflow-y: scroll;" id="dashboard">
          <p class="title is-4 has-text-white pt-6 pl-6">{{project.name}} <span class="is-size-6 has-text-weight-normal is-clickable is-hoverable has-text-info" *ngIf="project.status == 'finished'" (click)="downloadPDF()"> <i class='bx bxs-file-pdf'></i></span></p>
          <p class="subtitle is-5 has-text-white pt-4 px-6">{{project.description}}</p>
          <p class="subtitle is-6 has-text-white pt-4 px-6 mb-2">Cr√©e le : {{project.createdAt.slice(0,10)}}</p>
          <p class="subtitle is-6 has-text-white px-6">Modifi√© le : {{project.updatedAt.slice(0,10)}}</p>
          <div class="field px-6 mt-3 has-text-white" *ngIf='project.status'>
            <label class="label has-text-white">Etapes du Projet :</label>
            <br>
            <ul class="steps has-content-centered">
              <li *ngIf='project.status != "created"' class="steps-segment">
                <span class="steps-marker"></span>
                <div class="steps-content">
                  <p class="subtitle is-6 has-text-white">Cr√©ation</p>
                </div>
              </li>
              <li *ngIf='project.status == "created"' class="steps-segment is-active">
                <span class="steps-marker"></span>
                <div class="steps-content">
                  <p class="subtitle is-6 has-text-white">Cr√©ation</p>
                </div>
              </li>
              <li *ngIf='project.status != "running"' class="steps-segment">
                <span class="steps-marker"></span>
                <div class="steps-content">
                  <p class="subtitle is-6 has-text-white">Execution</p>
                </div>
              </li>
              <li *ngIf='project.status == "running"' class="steps-segment is-active">
                <span class="steps-marker"></span>
                <div class="steps-content">
                  <p class="subtitle is-6 has-text-white">Execution</p>
                </div>
              </li>
              <li *ngIf='project.status != "ended"' class="steps-segment">
                <span class="steps-marker"></span>
                <div class="steps-content">
                  <p class="subtitle is-6 has-text-white">V√©rification</p>
                </div>
              </li>
              <li *ngIf='project.status == "ended"' class="steps-segment is-active">
                <span class="steps-marker"></span>
                <div class="steps-content">
                  <p class="subtitle is-6 has-text-white">V√©rification</p>
                </div>
              </li>
              <li *ngIf='project.status == "finished"' class="steps-segment is-active">
                <span class="steps-marker"></span>
                <div class="steps-content">
                  <p class="subtitle is-6 has-text-white">Termin√©</p>
                </div>
              </li>
              <li *ngIf='project.status != "finished"' class="steps-segment">
                <span class="steps-marker"></span>
                <div class="steps-content">
                  <p class="subtitle is-6 has-text-white">Termin√©</p>
                </div>
              </li>
            </ul>
          </div>
          <br>

          <div class="field px-6 mt-3 has-text-white">
            <label class="label has-text-white">Liste des Contraintes ({{project.contraints.length}}) <span class="has-text-weight-normal is-clickable is-hoverable has-text-info" (click)="displayConstraints()" *ngIf="project.contraints.length > 0"><span *ngIf='constraints.displayed == false'> - Voir </span> <span *ngIf='constraints.displayed == true'> - Cacher </span>la liste compl√®te</span></label> 
            <ul  *ngIf='constraints.displayed == true'>
              <li *ngFor="let contraint of project.contraints;">
                <p *ngIf='contraint.type == "trafficlight"'>üö¶ Feu de Signalisation √†
                  {{contraint.latitude.toString().slice(0,10)}}, {{contraint.longitude.toString().slice(0,10)}}</p>
                <p *ngIf='contraint.type == "stop"'>üõë Panneau Stop √† {{contraint.latitude.toString().slice(0,10)}},
                  {{contraint.longitude.toString().slice(0,10)}}</p>
                <p *ngIf='contraint.type == "yield"'>üîª C√©dez le Passage √†
                  {{contraint.latitude.toString().slice(0,10)}}, {{contraint.longitude.toString().slice(0,10)}}</p>
                <p *ngIf='contraint.type == "roundabout"'>üîÑ Carrefour √† sens giratoire √†
                  {{contraint.latitude.toString().slice(0,10)}}, {{contraint.longitude.toString().slice(0,10)}}</p>
              </li>
            </ul>
          </div>



          <div class="field px-6 mt-3 has-text-white" *ngIf='project.status == "finished"'>
            <label class="label has-text-white">R√©sultats ({{project.results.length}})</label>
            <ul>
              <li *ngFor="let contraint of project.results;">
                <p *ngIf='contraint.type == "sign" && contraint.value == "redlight"'>üö¶ Feu de Signalisation √†
                  <a (click)="zoomToPoint(contraint.coordonateX, contraint.coordonateY)">{{contraint.coordonateX.toString().slice(0,7)}}, {{contraint.coordonateY.toString().slice(0,7)}}</a></p>

                  <p *ngIf='contraint.type == "sign" && contraint.value == "priority_stop"'>
                  <span *ngIf='getModifState(contraint.id, "sign") == true'>üõë Nouveau Panneau Stop √† </span>
                  <span *ngIf='getModifState(contraint.id, "sign") == false'>üõë Ancien {{getSignOldModif(contraint.id)}} √† </span>
                  <a (click)="zoomToPoint(contraint.coordonateX, contraint.coordonateY)">{{contraint.coordonateX.toString().slice(0,7)}}, {{contraint.coordonateY.toString().slice(0,7)}}</a>
                  <a (click)="signSetPointStateAndOldState(contraint.id, contraint.coordonateX, contraint.coordonateY)"> ‚Ü©Ô∏è</a>
                </p>
                <p *ngIf='contraint.type == "sign" && contraint.value == "right_before_left"'>
                  <span *ngIf='getModifState(contraint.id, "sign") == true'>üî∫ Nouveau panneau priorit√© √† droite √† </span>
                  <span *ngIf='getModifState(contraint.id, "sign") == false'>üî∫ Ancien {{getSignOldModif(contraint.id)}} √† </span>
                  <a (click)="zoomToPoint(contraint.coordonateX, contraint.coordonateY)">{{contraint.coordonateX.toString().slice(0,7)}}, {{contraint.coordonateY.toString().slice(0,7)}}</a>
                  <a (click)="signSetPointStateAndOldState(contraint.id, contraint.coordonateX, contraint.coordonateY)"> ‚Ü©Ô∏è</a>
                </p>
                <p *ngIf='contraint.type == "sign" && contraint.value == "priority"'>
                  <span *ngIf='getModifState(contraint.id, "priority") == true'>üî∫ Nouveau panneau priorit√© √† </span>
                  <span *ngIf='getModifState(contraint.id, "priority") == false'>üî∫ Ancien {{getSignOldModif(contraint.id)}} √† </span>
                  <a (click)="zoomToPoint(contraint.coordonateX, contraint.coordonateY)">{{contraint.coordonateX.toString().slice(0,7)}}, {{contraint.coordonateY.toString().slice(0,7)}}</a>
                  <a (click)="signSetPointStateAndOldState(contraint.id, contraint.coordonateX, contraint.coordonateY)"> ‚Ü©Ô∏è</a>
                </p>

                <p *ngIf='contraint.type == "yield"'>üîª C√©dez le Passage √† 
                  <a (click)="zoomToPoint(contraint.coordonateX, contraint.coordonateY)">{{contraint.latitude.toString().slice(0,7)}}, {{contraint.longitude.toString().slice(0,7)}}</a></p>
                <p *ngIf='contraint.type == "roundabout"'>üîÑ Carrefour √† sens giratoire √† 
                  <a (click)="zoomToPoint(contraint.coordonateX, contraint.coordonateY)">{{contraint.latitude.toString().slice(0,7)}}, {{contraint.longitude.toString().slice(0,7)}}</a></p>

                <p *ngIf='contraint.type == "speed"' >üïõ {{getModifState(contraint.id, "speed") ? "Nouvelle vitesse limit√© " : "Ancienne vitesse limit√© √† " }}
                  {{(getModifState(contraint.id, "speed") == true) ? (contraint.value * 3.6 ).toFixed(0): (contraint.oldValue * 3.6).toFixed(0)}} km/h √†
                  <a (click)="zoomToPoint(contraint.coordonateX, contraint.coordonateY)">{{contraint.coordonateX.toString().slice(0,7)}}, {{contraint.coordonateY.toString().slice(0,7)}}</a>
                  <a (click)="speedSetPointStateAndOldState(contraint.id, contraint.coordonateX, contraint.coordonateY)"> ‚Ü©Ô∏è</a>
                </p>

                <p *ngIf='contraint.type == "priority_up"'>
                  <span *ngIf='getModifState(contraint.id, "priority_up") == true'>‚è´ Augmentation de la priorit√© √† </span>
                  <span *ngIf='getModifState(contraint.id, "priority_up") == false'>‚è´ Ancienne priorit√© de la route √† </span>
                  <a (click)="zoomToPoint(contraint.coordonateX, contraint.coordonateY)">{{contraint.coordonateX.toString().slice(0,7)}}, {{contraint.coordonateY.toString().slice(0,7)}}</a>
                  <a (click)="priorityUpSetPointStageAndOldState(contraint.id, contraint.coordonateX, contraint.coordonateY)"> ‚Ü©Ô∏è</a>
                </p>

                <p *ngIf='contraint.type == "priority_down"' >
                  <span *ngIf='getModifState(contraint.id, "priority_down") == true'>‚è¨ Priorit√© de la route baiss√© √† </span>
                  <span *ngIf='getModifState(contraint.id, "priority_down") == false'>‚è¨ Ancienne priorit√© de la route √† </span>
                  <a (click)="zoomToPoint(contraint.coordonateX, contraint.coordonateY)">{{contraint.coordonateX.toString().slice(0,7)}}, {{contraint.coordonateY.toString().slice(0,7)}}</a>
                  <a (click)="priorityDownSetPointStageAndOldState(contraint.id, contraint.coordonateX, contraint.coordonateY)"> ‚Ü©Ô∏è</a>
                </p>

                <p *ngIf='contraint.type == "traffic_light"' >
                  <span *ngIf="getModifState(contraint.id, 'traffic_light') == true">üö¶ Changement des cycles du feux √† </span>
                  <span *ngIf="getModifState(contraint.id, 'traffic_light') == false">üö¶ Ancien cyle du feu √† </span>
                  <a (click)="zoomToPoint(contraint.coordonateX, contraint.coordonateY)">{{contraint.coordonateX.toString().slice(0,7)}}, {{contraint.coordonateY.toString().slice(0,7)}}</a>
                  <a (click)="tlSetPointStageAndOldState(contraint.id, contraint.coordonateX, contraint.coordonateY)"> ‚Ü©Ô∏è</a>
                  <li *ngFor="let cycle of (getModifState(contraint.id, 'traffic_light') == true ? contraint.value['newTlCycle']: contraint.oldValue['newTlCycle'])" style="margin-left: 5%;" >cycle num√©ro {{cycle["cycleNb"]}}, dur√©e : {{cycle["duration"]}} secondes. <a (click)="changeCycle(contraint.id, cycle['cycleNb'])"> {{getCycleDispValue(contraint.id, cycle['cycleNb'] - 1) == 0 ? 'open' : 'close'}}</a>
                    <p *ngIf="cycle['dispBool']">
                      <li *ngFor="let direction of cycle['detail']" style="margin-left: 5%">De la route {{direction["fromNode"]}} √† la route {{direction["toNode"]}}
                      <span style="height: 25px; width: 25px; border-radius: 50%; display: inline-block" [style.background]="direction['color'] == 'vert' ? 'green' : 'yellow'"></span></li>
                    </p>
                  </li>
                </p>
              </li>
            </ul>
            <p>
            <label *ngIf="this.graphicTrip || this.graphicRoad" class="label has-text-white mt-5">Graphique d'am√©lioration</label>
              <img *ngIf="this.graphicTrip" style="max-width: 50%; height: auto; padding: 5px;" src="{{this.graphicTrip}}" alt="graphique">
              <img *ngIf="this.graphicRoad"style="max-width: 50%; height: auto; padding: 5px;" src="{{this.graphicRoad}}" alt="graphique">
            </p>
          </div>
        </div>
        <div class="column is-6 map p-0" id="map" style="border-radius: 24px;">
        </div>
      </div>
    </div>
  </div>
</div>